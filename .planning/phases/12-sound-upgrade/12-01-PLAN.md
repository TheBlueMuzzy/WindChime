---
phase: 12-sound-upgrade
plan: 01
type: execute
---

<objective>
Set up Python audio processing environment and run duplicate detection on the 20 Source2 recordings.

Purpose: Identify near-identical recordings (>90% waveform similarity) before splicing, so Muzzy can curate which sources to keep. Prevents wasting effort splicing duplicates.
Output: Duplicate analysis report showing which Source2 files are near-identical, ready for Muzzy to decide which to remove.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-sound-upgrade/12-CONTEXT.md

**Key files:**
@audio/Source2/ (20 mp3 files to analyze)

**Tech stack available:** Vite 7.3.1, React 19, TypeScript, Web Audio API
**Established patterns:** Python scripts in `scripts/` directory, `audio/` for source material
**Constraining decisions:**
- Phase 3: Web Audio API for playback (not changing the engine)
- Phase 4: QR rawValue used directly as sound ID (`Chime_XX`)
- Phase 8: `import.meta.env.BASE_URL` prefix for public assets

**From CONTEXT.md:** Duplicate detection uses waveform comparison, not filename matching. Flag only near-identical recordings (>90% similarity). This is step 1 of a two-step workflow — must complete before splicing.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Python audio processing dependencies</name>
  <files>proto/requirements.txt</files>
  <action>
Install the Python packages needed for audio analysis and QR generation (used across multiple plans):
- `pydub` — audio loading, splicing, fade effects
- `librosa` — waveform comparison, audio feature extraction
- `numpy` — numerical operations for waveform comparison
- `qrcode[pil]` — QR code image generation (needed in Plan 03)

Create `proto/requirements.txt` listing all packages. Install via pip:
```
python3 -m pip install pydub librosa numpy qrcode[pil]
```

Also check for ffmpeg — pydub needs it for mp3 decoding. If ffmpeg is not installed, install it via:
- Windows: `winget install ffmpeg` or download from ffmpeg.org

Verify by running a quick Python import test.
  </action>
  <verify>python3 -c "import pydub, librosa, numpy, qrcode; print('All packages ready')" succeeds</verify>
  <done>All four Python packages importable, ffmpeg available for pydub mp3 decoding</done>
</task>

<task type="auto">
  <name>Task 2: Create duplicate detection script and run analysis</name>
  <files>scripts/detect-duplicates.py</files>
  <action>
Create `scripts/detect-duplicates.py` that:

1. Loads all 20 mp3 files from `audio/Source2/`
2. For each pair of files, computes waveform similarity:
   - Load audio as mono waveform using librosa
   - Normalize both waveforms to same amplitude range
   - Use cross-correlation to find best alignment, then compute similarity score
   - Alternatively: compare MFCC features (mel-frequency cepstral coefficients) which are robust to small timing differences
3. Flag pairs with >90% similarity as "near-identical"
4. Print a clear report:
   - List of all pairs above 90% threshold with their similarity scores
   - List of all pairs between 70-90% ("worth reviewing")
   - Summary: "X files are potential duplicates. Review and remove before splicing."

The script should handle files of different lengths gracefully (compare the shorter duration's worth of audio).

Use librosa for loading (handles mp3 via ffmpeg backend) and numpy for correlation/MFCC comparison.

Run the script and capture its output.
  </action>
  <verify>python3 scripts/detect-duplicates.py runs without errors, produces a readable duplicate report</verify>
  <done>Report generated showing which Source2 files are near-identical (>90%) and which are borderline (70-90%)</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Duplicate detection analysis of 20 Source2 recordings</what-built>
  <how-to-verify>
    1. Review the duplicate report output
    2. Decide which files to keep/remove from `audio/Source2/`
    3. Remove unwanted duplicate files manually (or tell Claude which to delete)
    4. After curation, confirm how many source files remain
  </how-to-verify>
  <resume-signal>Tell me which files to remove, or say "no duplicates found, proceed" to continue to splicing</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Python packages installed and importable
- [ ] Duplicate detection script runs successfully
- [ ] Muzzy has reviewed duplicates and curated Source2 folder
- [ ] Clear count of remaining source files for splicing
</verification>

<success_criteria>

- Python audio environment fully working
- Duplicate analysis report generated
- Muzzy has curated Source2 files
- Ready for Plan 02 (splicing)
</success_criteria>

<output>
After completion, create `.planning/phases/12-sound-upgrade/12-01-SUMMARY.md`
</output>

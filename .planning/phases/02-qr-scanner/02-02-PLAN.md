---
phase: 02-qr-scanner
plan: 02
type: execute
---

<objective>
Handle camera permission grant and denial gracefully — show clear feedback when permission is denied or camera unavailable.

Purpose: Users need to know why the camera isn't working and what to do about it.
Output: Permission denied state with user-friendly message, error handling for camera failures.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-qr-scanner/02-01-SUMMARY.md

# Key files:
@src/App.tsx
@src/components/QrScanner.tsx

**Tech stack available:** vite@7.3.1, react@19, @yudiel/react-qr-scanner@2.5.1
**Established patterns:** inline styles, dvh/dvw viewport units
**Constraining decisions:**
- Phase 1: Inline styles for app shell
- Plan 02-01: QrScanner wrapper with onError prop
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add camera permission state management to App</name>
  <files>src/App.tsx</files>
  <action>Add state to App to track camera status: 'loading' | 'active' | 'denied' | 'error'.

Start in 'loading' state. When QrScanner's onScan fires for the first time, set state to 'active'. When onError fires, check the error:
- If error is a DOMException with name 'NotAllowedError' or 'PermissionDeniedError' → set 'denied'
- All other errors → set 'error'

Conditionally render based on state:
- 'loading': Show the QrScanner (camera is starting up) with a simple "Starting camera..." text overlay centered on top of the scanner area
- 'active': Show just the QrScanner (hide the loading text)
- 'denied': Hide QrScanner. Show a centered message: "Camera access needed" with subtext "This app needs your camera to scan QR codes. Please allow camera access in your browser settings." White text on #111 background. Use inline styles.
- 'error': Hide QrScanner. Show: "Camera unavailable" with subtext "Something went wrong accessing your camera. Try refreshing the page." Include a "Try Again" button that reloads the page (window.location.reload()).

Keep all styles inline. Keep it simple — this is functional, not pretty (Phase 9 handles proper visual polish).</action>
  <verify>npx tsc --noEmit passes. Deny camera permission → see denied message. Grant → see camera feed.</verify>
  <done>App handles all 4 camera states. Denied permission shows clear message. Error shows retry option. No TypeScript errors.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Camera permission handling with denied/error states</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Open on phone or browser with camera
    3. Test GRANT flow: Allow camera → confirm live feed appears, loading text disappears
    4. Test DENY flow: Reset camera permission in browser settings, reload, deny permission → confirm "Camera access needed" message appears
    5. Test ERROR flow: (optional, hard to trigger) → confirm "Camera unavailable" with Try Again button exists in code
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx tsc --noEmit` passes
- [ ] `npm run build` succeeds
- [ ] Camera denied state shows user-friendly message
- [ ] Camera granted state shows live feed
</verification>

<success_criteria>

- All 4 camera states handled (loading, active, denied, error)
- Permission denied shows clear, non-technical message
- Error state shows refresh/retry option
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-qr-scanner/02-02-SUMMARY.md`
</output>

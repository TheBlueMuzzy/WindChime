---
phase: 02-qr-scanner
plan: 03
type: execute
---

<objective>
Display detected QR code value on screen as proof of life — single code detection with visible output.

Purpose: Prove the full scan pipeline works: camera → detect → display. Foundation for Phase 3 audio trigger.
Output: When a QR code is scanned, its value appears on screen in real-time.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-qr-scanner/02-01-SUMMARY.md
@.planning/phases/02-qr-scanner/02-02-SUMMARY.md

# Key files:
@src/App.tsx
@src/components/QrScanner.tsx

**Tech stack available:** vite@7.3.1, react@19, @yudiel/react-qr-scanner@2.5.1
**Established patterns:** inline styles, dvh/dvw viewport units
**Constraining decisions:**
- Plan 02-01: QrScanner fires onScan with IDetectedBarcode[] array
- Plan 02-02: Camera state management in App.tsx
- IDetectedBarcode has: rawValue (string), boundingBox ({x, y, width, height}), cornerPoints, format
</context>

<tasks>

<task type="auto">
  <name>Task 1: Display last detected QR value on screen</name>
  <files>src/App.tsx</files>
  <action>Add state to track the last detected QR code value (string | null, default null).

In the onScan handler (currently console.log), update: if detectedCodes.length > 0, set lastDetected to detectedCodes[0].rawValue. Keep the console.log for debugging.

Render a detection display overlay at the bottom of the camera container when lastDetected is not null. Style it as:
- Position: absolute, bottom: 0, left: 0, right: 0
- Background: rgba(0, 0, 0, 0.7)
- Padding: 12px 16px
- Color: #0f0 (green — clearly visible as "detected" state)
- Font: monospace, 0.9rem
- Text: "Detected: {rawValue}"
- Border-radius: 0 0 8px 8px (match container bottom corners)

The parent container (the 80%x60% camera box) needs position: 'relative' to anchor the absolute overlay.

This is temporary UI — Phase 9 replaces it with proper visual feedback. Keep it simple and functional.</action>
  <verify>npx tsc --noEmit passes. Point camera at a QR code → green text appears at bottom showing the QR value.</verify>
  <done>QR code value displayed on screen in real-time when detected. Overlay visible at bottom of camera feed. rawValue text matches the actual QR code content.</done>
</task>

<task type="auto">
  <name>Task 2: Add detection count and clear behavior</name>
  <files>src/App.tsx</files>
  <action>Add a detection counter (number state, starts at 0) that increments each time onScan fires with codes.length > 0. Display the count next to the detected value: "Detected: {rawValue} (scan #{count})".

Add auto-clear: when no codes are detected for 2 seconds (onScan fires with empty array or doesn't fire), clear the lastDetected value back to null so the overlay disappears. Use a useRef to hold a timeout ID. On each successful detection, clear the previous timeout and set a new 2-second timeout. This gives visual feedback that scanning is "live" — the overlay appears when pointed at a QR code and disappears when moved away.

Remove the console.log from onScan (it's served its debugging purpose).</action>
  <verify>npx tsc --noEmit passes. Point at QR → overlay appears with count. Move away → overlay disappears after 2s. Point again → count increments.</verify>
  <done>Detection overlay appears/disappears reactively. Count shows scan activity. Auto-clears after 2s without detection. No console noise.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Full QR scanning proof of life — camera detects QR code and displays value on screen</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Open on phone
    3. Point camera at any QR code (use one from the internet or generate at qr-code-generator.com)
    4. Confirm: Green overlay at bottom shows "Detected: [value] (scan #1)"
    5. Move camera away from QR code
    6. Confirm: Overlay disappears after ~2 seconds
    7. Point back at QR code
    8. Confirm: Overlay reappears with incremented scan count
    9. Test with a different QR code — confirm different rawValue shown
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npx tsc --noEmit` passes
- [ ] `npm run build` succeeds
- [ ] QR code detection works on real device
- [ ] Detection overlay appears and auto-clears
- [ ] Phase 2 complete — ready for Phase 3 (audio engine)
</verification>

<success_criteria>

- All tasks completed
- QR code rawValue displayed on screen when detected
- Detection overlay auto-clears when QR code leaves frame
- Scan count visible for debugging
- No TypeScript errors
- Phase 2: QR Scanner Integration complete
</success_criteria>

<output>
After completion, create `.planning/phases/02-qr-scanner/02-03-SUMMARY.md`

Update STATE.md:
- Current position: Phase 2 complete
- Progress: ██▓░░░░░░░ 16%
</output>

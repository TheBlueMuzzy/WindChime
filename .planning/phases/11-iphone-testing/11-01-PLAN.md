---
phase: 11-iphone-testing
plan: 01
type: execute
---

<objective>
Verify the Wind Chime app works on iOS Safari — proactive compatibility fixes, then real-device testing with an iPhone tester.

Purpose: This is the final phase. The app must work on iOS Safari for the core experience (camera → QR scan → sound plays) to be complete.
Output: Working app on iOS Safari, deployed, verified by real iPhone user.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-iphone-testing/11-CONTEXT.md
@.planning/phases/10-polish/10-01-SUMMARY.md
@.planning/phases/08-git-deploy/08-01-SUMMARY.md

# Key source files:
@src/App.tsx
@src/components/QrScanner.tsx
@src/hooks/useAudioEngine.ts
@vite.config.ts
@package.json

**Tech stack available:** Vite 7, React 19, TypeScript, @yudiel/react-qr-scanner 2.5, barcode-detector 3.0 (WASM polyfill), Web Audio API, gh-pages
**Established patterns:** Lazy AudioContext with webkitAudioContext fallback, deferred sound loading after tap, video polling for camera detection, canvas tracker for QR highlights
**Constraining decisions:**
- barcode-detector polyfill handles iOS (no native BarcodeDetector on Safari)
- webkitAudioContext fallback already in useAudioEngine.ts
- Deferred sound loading (after tap) — required because mobile AudioContext must be resumed first
- Deploy via `npm run deploy` → GitHub Pages at thebluemuzzy.github.io/WindChime/
</context>

<tasks>

<task type="auto">
  <name>Task 1: iOS Safari pre-flight audit and proactive fixes</name>
  <files>src/hooks/useAudioEngine.ts, src/App.tsx, src/components/QrScanner.tsx, vite.config.ts, index.html</files>
  <action>
Audit all source files for known iOS Safari compatibility issues and fix proactively BEFORE sending to tester. Check each item and fix only what's actually broken — do NOT change things that already work:

1. **barcode-detector polyfill loading** — Verify the polyfill import path is correct and the WASM module will load on iOS Safari. Check that `barcode-detector` package is in dependencies (it is). If the @yudiel/react-qr-scanner library auto-detects and loads the polyfill, confirm this. If manual polyfill registration is needed, add it.

2. **AudioContext fallback** — `webkitAudioContext` fallback is already in useAudioEngine.ts line 31. Verify it works. Specifically check: does `ctx.resume()` work on webkit? Does `decodeAudioData` work after resume? These should be fine — just verify.

3. **CSS compatibility** — `dvh`/`dvw` units require iOS 15.4+. Since the target is "modern iPhone", this is fine. `ctx.roundRect` fallback is already present. No action needed unless something else is found.

4. **Version display in debug log** — The debug bar shows hardcoded `v0.1.1.4` (App.tsx line 293). Update this to read from version.json or at least match the current version (0.1.2.3). This helps the tester confirm they're on the latest deploy.

5. **Build verification** — Run `npm run build` to confirm no TypeScript errors exist before deploying.

6. **Deploy** — Run `npm run deploy` to push latest to GitHub Pages.

Do NOT refactor, add features, or change behavior. Only fix actual compatibility issues and update the version display.
  </action>
  <verify>
- `npm run build` succeeds with no errors
- `npm run deploy` succeeds
- Visit thebluemuzzy.github.io/WindChime/ on desktop to confirm it loads
  </verify>
  <done>
- All known iOS Safari compatibility concerns verified or fixed
- App built and deployed to GitHub Pages
- Version display matches actual version
- Ready for iPhone tester
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
iOS-audited and deployed Wind Chime app at thebluemuzzy.github.io/WindChime/

The app has been checked for known iOS Safari issues and deployed. Time to test on a real iPhone.
  </what-built>
  <how-to-verify>
**Share this link with your iPhone tester:**
https://thebluemuzzy.github.io/WindChime/

**Test checklist — ask them to try each step:**

1. **Open the link** in Safari on iPhone
   - Does the page load? Do they see "Starting camera..."?

2. **Camera permission**
   - Does Safari ask for camera access?
   - After allowing, does the camera feed appear?

3. **Tap to begin**
   - Does the "Tap anywhere to begin scanning" overlay appear?
   - After tapping, does it go away?

4. **QR scanning**
   - Open https://thebluemuzzy.github.io/WindChime/codes.html on a computer
   - Point iPhone camera at QR codes on the computer screen
   - Do green highlight boxes appear on detected codes?

5. **Sound playback**
   - When QR codes are detected, do sounds actually play?
   - Do the "Currently Playing" indicators appear?

6. **Multiple codes**
   - Point at 2-3 QR codes at once — do multiple sounds play?

7. **Debug bar**
   - What does the bottom debug bar show? (version, ON/OFF state, scan count)
   - Are there any error messages in the debug log?

**Report back:** What worked, what broke, any error messages from the debug bar.
  </how-to-verify>
  <resume-signal>
Report what the tester found:
- "All works" → Phase complete, we're done!
- Describe any issues → I'll fix them and redeploy for another round of testing
  </resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] App loads on iOS Safari
- [ ] Camera activates and QR codes are detected
- [ ] Sounds play when QR codes are scanned
- [ ] Multiple sounds can play simultaneously
- [ ] No JavaScript errors or blank screens
- [ ] Real iPhone tester confirms core experience works
</verification>

<success_criteria>

- iPhone tester confirms: camera works, QR scanning works, sounds play
- Core experience verified: point camera at cards → hear sounds
- App deployed to GitHub Pages with all fixes
- Phase 11 complete — v1 prototype done
  </success_criteria>

<output>
After completion, create `.planning/phases/11-iphone-testing/11-01-SUMMARY.md`:

# Phase 11 Plan 01: iPhone Testing & Fixes Summary

**[What was found and fixed]**

## Accomplishments
- [Pre-flight fixes applied]
- [Issues found by tester and fixed]
- [Final deploy confirmed working]

## Files Created/Modified
- [List of files changed]

## Decisions Made
[Any iOS-specific decisions]

## Issues Encountered
[What broke on iPhone, how it was fixed]

## Next Step
Phase complete — Wind Chime v1 prototype is done.
</output>

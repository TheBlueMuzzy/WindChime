{
  "hooks": {
    "SessionStart": [
      {
        "matcher": "startup|resume|clear|compact",
        "hooks": [
          {
            "type": "command",
            "command": "BMUZ_V=$(cat \"$HOME/.claude/config/bmuz/version\" 2>/dev/null); GAME_V=$(cd \"$CLAUDE_PROJECT_DIR\" && node -e \"const v=require('./version.json'); console.log('v'+v.version+'.'+v.build)\" 2>/dev/null); if [ -n \"$BMUZ_V\" ]; then echo '══════════════════════════════════════'; echo \"  BMUZ v${BMUZ_V} — Game Dev Toolkit\"; if [ -n \"$GAME_V\" ]; then GAME_NAME=$(cd \"$CLAUDE_PROJECT_DIR\" && node -e \"console.log(require('./version.json').name)\" 2>/dev/null); echo \"  ${GAME_NAME} ${GAME_V}\"; fi; echo '══════════════════════════════════════'; fi && echo '' && echo '=== SESSION CONTEXT ===' && cat \"$CLAUDE_PROJECT_DIR/.planning/STATE.md\" 2>/dev/null && echo '' && echo '=== GIT STATUS ===' && git -C \"$CLAUDE_PROJECT_DIR\" status --short && echo '' && echo '=== BRANCH ===' && git -C \"$CLAUDE_PROJECT_DIR\" branch --show-current && echo '' && echo '=== RECENT COMMITS ===' && git -C \"$CLAUDE_PROJECT_DIR\" log --oneline -5 && bash \"$HOME/.claude/config/bmuz/templates/check-plugins.sh\" 2>/dev/null"
          }
        ]
      }
    ],
    "PreCompact": [
      {
        "matcher": "auto",
        "hooks": [
          {
            "type": "command",
            "command": "cp \"$CLAUDE_PROJECT_DIR/.planning/STATE.md\" \"$CLAUDE_PROJECT_DIR/.planning/STATE.md.bak\" 2>/dev/null; echo 'STATE.md backed up before auto-compaction'"
          }
        ]
      }
    ],
    "Stop": [
      {
        "hooks": [
          {
            "type": "prompt",
            "prompt": "Review this conversation: \n\nCheck TWO things:\n1. Did Claude make code changes (Edit/Write tool calls) in this turn?\n2. If yes, did Claude update .planning/STATE.md with what changed?\n\nIMPORTANT: If stop_hook_active is true, respond {\"ok\": true} to prevent loops.\n\nIf code changes were made WITHOUT updating STATE.md, respond:\n{\"ok\": false, \"reason\": \"Code changes detected but STATE.md not updated. Update .planning/STATE.md with: what changed, current status, any decisions made, and next steps. Then provide the Handoff Block.\"}\n\nOtherwise respond {\"ok\": true}",
            "timeout": 30
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "cd \"$CLAUDE_PROJECT_DIR\" && npm run test:run 2>&1 | tail -20"
          }
        ]
      }
    ]
  }
}
